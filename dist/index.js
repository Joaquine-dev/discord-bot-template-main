"use strict";var Ue=Object.create;var E=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var We=Object.getOwnPropertyNames;var je=Object.getPrototypeOf,ze=Object.prototype.hasOwnProperty;var B=o=>e=>{var t=o[e];if(t)return t();throw new Error("Module not found in bundle: "+e)};var h=(o,e)=>()=>(o&&(e=o(o=0)),e);var te=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),L=(o,e)=>{for(var t in e)E(o,t,{get:e[t],enumerable:!0})},oe=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of We(e))!ze.call(o,n)&&n!==t&&E(o,n,{get:()=>e[n],enumerable:!(r=ee(e,n))||r.enumerable});return o};var D=(o,e,t)=>(t=o!=null?Ue(je(o)):{},oe(e||!o||!o.__esModule?E(t,"default",{value:o,enumerable:!0}):t,o)),G=o=>oe(E({},"__esModule",{value:!0}),o),d=(o,e,t,r)=>{for(var n=r>1?void 0:r?ee(e,t):e,s=o.length-1,c;s>=0;s--)(c=o[s])&&(n=(r?c(e,t,n):c(n))||n);return r&&n&&E(e,t,n),n};var Ye,y,p,f,i,x,g=h(()=>{"use strict";Ye=require("colors"),y=D(require("fs")),p=(...o)=>{let e=new Date().toLocaleTimeString(),t=y.readFileSync("./terminal.log","utf-8");console.info(`[${e}]`.gray,"[Info]".blue,o.join(" ")),t+=[`[${e}]`.gray,"[Info]".blue,o.join(" ")].join(" ")+`
`,y.writeFileSync("./terminal.log",t,"utf-8")},f=(...o)=>{let e=new Date().toLocaleTimeString(),t=y.readFileSync("./terminal.log","utf-8");console.info(`[${e}]`.gray,"[OK]".green,o.join(" ")),t+=[`[${e}]`.gray,"[OK]".green,o.join(" ")].join(" ")+`
`,y.writeFileSync("./terminal.log",t,"utf-8")},i=(...o)=>{let e=new Date().toLocaleTimeString(),t=y.readFileSync("./terminal.log","utf-8");console.error(`[${e}]`.gray,"[Error]".red,o.join(" ")),t+=[`[${e}]`.gray,"[Error]".red,o.join(" ")].join(" ")+`
`,y.writeFileSync("./terminal.log",t,"utf-8")},x=(...o)=>{let e=new Date().toLocaleTimeString(),t=y.readFileSync("./terminal.log","utf-8");console.warn(`[${e}]`.gray,"[Warning]".yellow,o.join(" ")),t+=[`[${e}]`.gray,"[Warning]".yellow,o.join(" ")].join(" ")+`
`,y.writeFileSync("./terminal.log",t,"utf-8")}});var U,R,W=h(()=>{"use strict";U=class{constructor(e){this.toJSON=()=>({...this.data});this.data={__type__:1,...e}}},R=U});var _,l,A=h(()=>{"use strict";_=require("typeorm"),l=class{};d([(0,_.PrimaryGeneratedColumn)()],l.prototype,"id",2),d([(0,_.Column)({unique:!0,type:"bigint"})],l.prototype,"discordId",2),d([(0,_.Column)({type:"varchar"})],l.prototype,"username",2),d([(0,_.Column)({default:0,type:"bigint"})],l.prototype,"xp",2),d([(0,_.Column)({default:0,type:"bigint"})],l.prototype,"level",2),l=d([(0,_.Entity)()],l)});var re=te((rt,ne)=>{"use strict";W();A();ne.exports=new R({command:{name:"getclient",description:"Message d'annonce",options:[]},options:{botDevelopers:!0},run:async(o,e)=>{if(!e.isChatInputCommand()||!e.member)return;let t=await o.database.getClient().getRepository(l).find();console.log(t)}}).toJSON()});var Fe,a,S=h(()=>{"use strict";Fe={development:{enabled:!0,guildId:"1369258577990123612"},commands:{prefix:"--",message_commands:!0,application_commands:{chat_input:!0,user_context:!0,message_context:!0}},users:{ownerId:"1361668952475832528",developers:["1361668952475832528"]},messages:{NOT_BOT_OWNER:"Vous n'avez pas la permission d'ex\xE9cuter cette commande car vous n'\xEAtes pas mon propri\xE9taire !",NOT_BOT_DEVELOPER:"Vous n'avez pas la permission d'ex\xE9cuter cette commande car vous n'\xEAtes pas un de mes d\xE9veloppeurs !",NOT_GUILD_OWNER:"Vous n'avez pas la permission d'ex\xE9cuter cette commande car vous n'\xEAtes pas le propri\xE9taire du serveur !",CHANNEL_NOT_NSFW:"Vous ne pouvez pas ex\xE9cuter cette commande dans un canal non NSFW !",MISSING_PERMISSIONS:"Vous n'avez pas la permission d'ex\xE9cuter cette commande, permissions manquantes.",COMPONENT_NOT_PUBLIC:"Vous n'\xEAtes pas l'auteur de ce bouton !",GUILD_COOLDOWN:"Vous \xEAtes actuellement en p\xE9riode de recharge, vous pourrez r\xE9utiliser cette commande dans `%cooldown%s`."}},a=Fe});var ae=te((lt,ie)=>{"use strict";var se=require("discord.js");W();S();ie.exports=new R({command:{name:"reload",description:"Reload every command.",options:[]},options:{botDevelopers:!0},run:async(o,e)=>{if(e.isChatInputCommand()){await e.deferReply();try{o.commands_handler.reload(),await o.commands_handler.registerApplicationCommands(a.development),await e.editReply({content:"Successfully reloaded application commands and message commands."})}catch(t){console.error(t),await e.editReply({content:`Something went wrong: ${t.message||t}`,files:[new se.AttachmentBuilder(Buffer.from(`${t}`,"utf-8"),{name:"output.ts"})]})}}}}).toJSON()});var C,u,H=h(()=>{"use strict";C=require("typeorm"),u=class{};d([(0,C.PrimaryGeneratedColumn)()],u.prototype,"id",2),d([(0,C.Column)({type:"bigint"})],u.prototype,"guildId",2),d([(0,C.Column)({type:"varchar"})],u.prototype,"name",2),d([(0,C.Column)({type:"bigint",nullable:!0})],u.prototype,"channelWelcome",2),u=d([(0,C.Entity)()],u)});var $,ge=h(()=>{"use strict";H();$=class{static async createGuildIfNotExist(e,t){let r=e.database.getClient().getRepository(u),n=await r.findOne({where:{guildId:t.id}});return n||(n=r.create({guildId:t.id,name:t.name}),await r.save(n)),n}static async getGuildById(e,t){return await e.database.getClient().getRepository(u).findOne({where:{guildId:t}})}}});var T,ye=h(()=>{"use strict";A();T=class{static async createUserIfNotExists(e,t){let r=e.database.getClient().getRepository(l),n=await r.findOne({where:{discordId:t.id}});return n||(n=r.create({discordId:t.id,username:t.user.username}),await r.save(n)),n}static async getUserById(e,t,r){return await e.database.getClient().getRepository(l).findOne({where:{discordId:t,guildId:r}})}}});var J,O,P=h(()=>{"use strict";J=class{constructor(e){this.toJSON=()=>({__type__:this.__type__,event:this.event,once:this.once,run:this.run});this.__type__=5,this.event=e.event,this.once=e.once,this.run=e.run}},O=J});var we={};L(we,{default:()=>Ve});var _e,Ve,be=h(()=>{"use strict";ge();ye();P();g();_e=require("discord.js"),Ve=new O({event:_e.Events.ClientReady,once:!0,run:async o=>{o.database.getClient().isInitialized||await new Promise(e=>setTimeout(e,1e3)),o.guilds.cache.forEach(async e=>{await $.createGuildIfNotExist(o,e),e.members.cache.forEach(async t=>{try{await T.createUserIfNotExists(o,t)}catch(r){i(`Erreur lors de la cr\xE9ation/r\xE9cup\xE9ration de l'utilisateur ${t.user.username}:`,r)}})})}}).toJSON()});var Ce={};L(Ce,{default:()=>Ke});var ve,Ke,Ie=h(()=>{"use strict";P();ve=require("discord.js"),Ke=new O({event:ve.Events.GuildMemberAdd,run:async(o,e)=>{}}).toJSON()});var Oe={};L(Oe,{default:()=>He});var Se,He,Ee=h(()=>{"use strict";P();Se=require("discord.js"),He=new O({event:Se.Events.GuildMemberRemove,run:async(o,e)=>{}}).toJSON()});var Lo=require("reflect-metadata"),Le=D(require("dotenv")),Ge=D(require("fs"));var m=require("discord.js");var N=require("discord.js"),j=require("fs");g();var ke=B({"../../commands/Developper/sc-getclient.ts":()=>re(),"../../commands/Developper/sc-reload.ts":()=>ae()});var z=class{constructor(e){this.load=()=>{for(let e of(0,j.readdirSync)("./src/commands/"))for(let t of(0,j.readdirSync)(`./src/commands/${e}`).filter(r=>r.endsWith(".ts")))try{let r=ke(`../../commands/${e}/${t}`);if(!r)continue;if(r.__type__===2){if(!r.command||!r.run){i(`Unable to load the message command ${t}`);continue}this.client.collection.message_commands.set(r.command.name,r),"aliases"in r.command&&Array.isArray(r.command.aliases)&&r.command.aliases.forEach(n=>{this.client.collection.message_commands_aliases.set(n,r.command.name)}),p(`Loaded new message command: ${t}`)}else if(r.__type__===1){if(!r.command||!r.run){i(`Unable to load the application command ${t}`);continue}this.client.collection.application_commands.set(r.command.name,r),this.client.rest_application_commands_array.push(r.command),p(`Loaded new application command: ${t}`)}else i(`Invalid command type ${r.__type__} from command file ${t}`)}catch{i(`Unable to load a command from the path: src/commands/${e}/${t}`)}f(`Successfully loaded ${this.client.collection.application_commands.size} application commands and ${this.client.collection.message_commands.size} message commands.`)};this.reload=()=>{this.client.collection.message_commands.clear(),this.client.collection.message_commands_aliases.clear(),this.client.collection.application_commands.clear(),this.client.rest_application_commands_array=[],this.load()};this.registerApplicationCommands=async(e,t=null)=>{if(!this.client.token)throw new Error("Bot token is not set");let r=new N.REST(t||{version:"10"}).setToken(this.client.token);if(!this.client.user)throw new Error("Client user is not initialized");e.enabled?await r.put(N.Routes.applicationGuildCommands(this.client.user.id,e.guildId),{body:this.client.rest_application_commands_array}):await r.put(N.Routes.applicationCommands(this.client.user.id),{body:this.client.rest_application_commands_array})};this.client=e}},ce=z;g();S();var I=require("discord.js");S();var me=require("discord.js");S();var b=new Map,v=new Map,le=async(o,e,t)=>{if(!o.isCommand())return!1;if(e.botOwner&&o.user.id!==a.users.ownerId)return await o.reply({content:a.messages.NOT_BOT_OWNER,ephemeral:!0}),!1;if(e.default_member_permissions&&o.memberPermissions&&!o.memberPermissions.has(e.default_member_permissions))return await o.reply({content:a.messages.MISSING_PERMISSIONS,ephemeral:!0}),!1;if(e.botDevelopers&&a.users?.developers?.length>0&&!a.users?.developers?.includes(o.user.id))return await o.reply({content:a.messages.NOT_BOT_DEVELOPER,ephemeral:!0}),!1;if(e.guildOwner&&o.guild&&o.user.id!==o.guild.ownerId)return await o.reply({content:a.messages.NOT_GUILD_OWNER,ephemeral:!0}),!1;if(e.cooldown){let r=()=>{let n=b.get(o.user.id)||[];n.push(o.commandName),b.set(o.user.id,n),setTimeout(()=>{let s=b.get(o.user.id)||[];s=s.filter(c=>c!==o.commandName),s.length<=0?b.delete(o.user.id):b.set(o.user.id,s)},e.cooldown)};if(b.has(o.user.id)){if((b.get(o.user.id)||[]).some(s=>s===o.commandName))return await o.reply({content:a.messages.GUILD_COOLDOWN.replace(/%cooldown%/g,(e.cooldown/1e3).toString()),ephemeral:!0}),!1;r()}else b.set(o.user.id,[o.commandName]),r()}return!0},de=async(o,e,t)=>{if(e.botOwner&&o.author.id!==a.users.ownerId)return await o.reply({content:a.messages.NOT_BOT_OWNER}),!1;if(e.botDevelopers&&a.users?.developers?.length>0&&!a.users?.developers?.includes(o.author.id))return await o.reply({content:a.messages.NOT_BOT_DEVELOPER}),!1;if(e.guildOwner&&o.guild&&o.author.id!==o.guild.ownerId)return await o.reply({content:a.messages.NOT_GUILD_OWNER}),!1;if(e.nsfw&&(!(o.channel instanceof me.TextChannel)||!o.channel.nsfw))return await o.reply({content:a.messages.CHANNEL_NOT_NSFW}),!1;if(e.cooldown){let r=()=>{let n=v.get(o.author.id)||[];n.push(t.name),v.set(o.author.id,n),setTimeout(()=>{let s=v.get(o.author.id)||[];s=s.filter(c=>c!==t.name),s.length<=0?v.delete(o.author.id):v.set(o.author.id,s)},e.cooldown)};if(v.has(o.author.id)){if((v.get(o.author.id)||[]).some(s=>s===t.name))return await o.reply({content:a.messages.GUILD_COOLDOWN.replace(/%cooldown%/g,(e.cooldown/1e3).toString())}),!1;r()}else v.set(o.author.id,[t.name]),r()}return!0};g();var F=class{constructor(e){e.on(I.Events.MessageCreate,async t=>{if(t.author.bot||t.channel.type===I.ChannelType.DM||!t.guild||!a.commands.message_commands)return;let r=a.commands.prefix;if(!t.content.startsWith(r))return;let n=t.content.slice(r.length).trim().split(/\s+/g),s=n.shift()?.toLowerCase();if(!s||!s.length)return;let c=e.collection.message_commands.get(s)||e.collection.message_commands.get(e.collection.message_commands_aliases.get(s)||"");if(c)try{if(c.options&&!await de(t,c.options,c.command))return;if(c.command?.permissions&&t.member&&!t.member.permissions.has(I.PermissionsBitField.resolve(c.command.permissions))){await t.reply({content:a.messages.MISSING_PERMISSIONS});return}c.run(e,t,n)}catch(w){i(w instanceof Error?w.message:String(w))}}),e.on(I.Events.InteractionCreate,async t=>{if(!t.isCommand()||!a.commands.application_commands.chat_input&&t.isChatInputCommand()||!a.commands.application_commands.user_context&&t.isUserContextMenuCommand()||!a.commands.application_commands.message_context&&t.isMessageContextMenuCommand())return;let r=e.collection.application_commands.get(t.commandName);if(r)try{if(r.options&&!await le(t,r.options,r.command))return;r.run(e,t)}catch(n){i(n instanceof Error?n.message:String(n))}})}},pe=F;g();var k=require("fs"),V=class{constructor(e){this.load=()=>{for(let t of(0,k.readdirSync)("./src/components/"))for(let r of(0,k.readdirSync)(`./src/components/${t}`).filter(n=>n.endsWith(".ts")))try{let n=require(`@components/${t}/${r}`).default;if(t==="reactions"||!n)continue;if(n.__type__===3){let s=n;if(!s.customId||!s.type||!s.run){i("Unable to load the button/select/modal component "+r);continue}switch(s.type){case"modal":Array.isArray(s.customId)?s.customId.forEach(c=>{this.client.collection.components.modals.set(c,s)}):this.client.collection.components.modals.set(s.customId,s);break;case"select":Array.isArray(s.customId)?s.customId.forEach(c=>{this.client.collection.components.selects.set(c,s)}):this.client.collection.components.selects.set(s.customId,s);break;case"button":Array.isArray(s.customId)?s.customId.forEach(c=>{this.client.collection.components.buttons.set(c,s)}):this.client.collection.components.buttons.set(s.customId,s);break;default:i("Invalid component type (not: button, select, or modal): "+r);continue}p(`Loaded new component (type: ${s.type}) : `+r)}else if(n.__type__===4){let s=n;if(!s.commandName||!s.run){i("Unable to load the autocomplete component "+r);continue}this.client.collection.components.autocomplete.set(s.commandName,s),p("Loaded new component (type: autocomplete) : "+r)}else i("Invalid component type "+n.__type__+" from component file "+r)}catch{i(`Unable to load a component from the path: src/component/${t}/${r}`)}let e=this.client.collection.components;f(`Successfully loaded ${e.autocomplete.size+e.buttons.size+e.selects.size+e.modals.size} components.`)};this.reload=()=>{this.client.collection.components.autocomplete.clear(),this.client.collection.components.buttons.clear(),this.client.collection.components.modals.clear(),this.client.collection.components.selects.clear(),this.load()};this.client=e}},ue=V;var fe=require("discord.js");S();g();var K=class{constructor(e){e.on(fe.Events.InteractionCreate,async t=>{let r=async n=>"message"in t&&n.options?.public===!1&&t.user.id!==t.user?.id?(await t.reply({content:a.messages.COMPONENT_NOT_PUBLIC,ephemeral:!0}),!1):!0;try{if(t.isButton()){let n=e.collection.components.buttons.get(t.customId);if(n||(n=Array.from(e.collection.components.buttons.values()).find(s=>s.customId instanceof RegExp&&s.customId.test(t.customId))),!n||!await r(n))return;try{n.run(e,t)}catch(s){i(s instanceof Error?s.message:String(s))}return}if(t.isAnySelectMenu()){let n=e.collection.components.selects.get(t.customId);if(!n||!await r(n))return;try{n.run(e,t)}catch(s){i(s instanceof Error?s.message:String(s))}return}if(t.isModalSubmit()){let n=e.collection.components.modals.get(t.customId);if(!n)return;try{n.run(e,t)}catch(s){i(s instanceof Error?s.message:String(s))}return}if(t.isAutocomplete()){let n=e.collection.components.autocomplete.get(t.commandName);if(!n)return;try{n.run(e,t)}catch(s){i(s instanceof Error?s.message:String(s))}return}}catch(n){i(n instanceof Error?n.message:String(n))}})}},he=K;g();var q=require("fs");var Je=B({"../../events/Client/ready.ts":()=>(be(),G(we)),"../../events/GuildMember/guildMemberAdd.ts":()=>(Ie(),G(Ce)),"../../events/GuildMember/guildMemberRemove.ts":()=>(Ee(),G(Oe))});var Q=class{constructor(e){this.load=()=>{let e=0;for(let t of(0,q.readdirSync)("./src/events/"))for(let r of(0,q.readdirSync)(`./src/events/${t}`).filter(n=>n.endsWith(".ts")))try{let n=Je(`../../events/${t}/${r}`).default;if(!n){i(`Module not found for ${r}`);continue}if(n.__type__!==5){i("Invalid event type "+n.__type__+" from event file "+r);continue}if(!n.event||!n.run){i("Unable to load the event "+r);continue}let s=n;p(`Registering event: ${r} with event type: ${s.event}`),s.once?this.client.once(s.event,async(...c)=>{p(`Executing once event: ${r}`);try{await s.run(this.client,...c)}catch(w){i(`Erreur lors de l'ex\xE9cution de l'\xE9v\xE9nement ${r}: ${w}`)}}):this.client.on(s.event,async(...c)=>{p(`Executing event: ${r}`);try{await s.run(this.client,...c)}catch(w){i(`Erreur lors de l'ex\xE9cution de l'\xE9v\xE9nement ${r}: ${w}`)}}),p("Loaded new event: "+r),e++}catch(n){i("Unable to load an event from the path: src/events/"+t+"/"+r),i(n)}f(`Successfully loaded ${e} events.`)};this.client=e}},De=Q;var Ne=require("discord.js");g();var Y=class{constructor(e){e.on(Ne.Events.MessageReactionAdd,async(t,r)=>{if(!r.bot)try{let n=t.emoji.name;if(!n)return;let s=e.collection.reactions.get(n);if(!s)return;try{await s.run(e,t,r)}catch(c){i(c instanceof Error?c.message:String(c))}}catch(n){i(n instanceof Error?n.message:String(n))}})}},Me=Y;var Be=require("fs");g();var X=class{constructor(e){this.load=()=>{for(let e of(0,Be.readdirSync)("./src/components/reactions/").filter(t=>t.endsWith(".ts")))try{let t=require(`@components/reactions/${e}`).default;if(!t)continue;let r=t;if(!r.emoji||!r.run){i("Unable to load the reaction: "+e);continue}this.client.collection.reactions.set(r.emoji,r),p(`Loaded reaction for emoji: ${r.emoji}`)}catch{i(`Unable to load reaction from path: src/components/reactions/${e}`)}f(`Successfully loaded ${this.client.collection.reactions.size} reactions.`)};this.reload=()=>{this.client.collection.reactions.clear(),this.load()};this.client=e}},xe=X;var bo=require("reflect-metadata");var Re=require("typeorm");A();H();var Ae=D(require("dotenv")),$e=D(require("path"));Ae.config();var Te=new Re.DataSource({type:"postgres",host:process.env.DB_HOST,port:parseInt(process.env.DB_PORT||"5432"),username:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME,entities:[l,u],migrations:[$e.default.join(__dirname,"..","migrations","*.ts")],synchronize:!1,logging:!1,logger:"advanced-console"});g();var M=class{constructor(){this.dataSource=Te}async connect(){this.dataSource.isInitialized||(await this.dataSource.initialize(),f("\u{1F5C4}\uFE0F TypeORM connect\xE9 \xE0 PostgreSQL"))}async disconnect(){this.dataSource.isInitialized&&(await this.dataSource.destroy(),i("\u{1F6D1} TypeORM d\xE9connect\xE9"))}getClient(){return this.dataSource}};var Z=class extends m.Client{constructor(){let t={intents:3276799,partials:[m.Partials.Channel,m.Partials.GuildMember,m.Partials.Message,m.Partials.Reaction,m.Partials.User],presence:{activities:[{name:"keep this empty",type:m.ActivityType.Custom,state:"Version TS"}]}};super(t);this.connect=async()=>{x(`Attempting to connect to the Discord bot... (${this.login_attempts+1})`);try{this.commands_handler.load(),this.components_handler.load(),this.events_handler.load(),this.reactions_handler.load(),await this.login(process.env.CLIENT_TOKEN),this.login_timestamp=Date.now(),await this.database.connect(),this.user?.setPresence({activities:[{name:"Discord Bot",type:m.ActivityType.Playing}]}),x("Attempting to register application commands... (this might take a while!)"),await this.application?.commands.set([]),x("Toutes les commandes existantes ont \xE9t\xE9 supprim\xE9es globalement."),await this.commands_handler.registerApplicationCommands(a.development),f("Successfully registered application commands. For specific guild? "+(a.development.enabled?"Yes":"No"))}catch(t){i("Failed to connect to the Discord bot, retrying..."),t instanceof Error?i(t.message):i("An unknown error occurred"),this.login_attempts++,setTimeout(this.connect,5e3)}};this.collection={application_commands:new m.Collection,message_commands:new m.Collection,message_commands_aliases:new m.Collection,components:{buttons:new m.Collection,selects:new m.Collection,modals:new m.Collection,autocomplete:new m.Collection},reactions:new m.Collection},this.rest_application_commands_array=[],this.login_attempts=0,this.login_timestamp=0,this.statusMessages=[{name:"Status 1",type:m.ActivityType.Custom},{name:"Status 2",type:m.ActivityType.Custom},{name:"Status 3",type:m.ActivityType.Custom}],this.commands_handler=new ce(this),this.components_handler=new ue(this),this.events_handler=new De(this),this.reactions_handler=new xe(this),this.database=new M,new pe(this),new he(this),new Me(this)}},Pe=Z;Le.default.config();Ge.default.writeFileSync("./terminal.log","[INFO]".blue+` [Bot loaded].
`,"utf-8");var qe=new Pe;qe.connect();process.on("unhandledRejection",console.error);process.on("uncaughtException",console.error);
